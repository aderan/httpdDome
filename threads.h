#ifndef THREAD_H
#define THREAD_H


#if defined(WIN32)
#include <windows.h>

#define sleepms(x) Sleep(x)

typedef HANDLE thread_handle_t;
#define THREAD_RETVAL DWORD WINAPI;
#define THREAD_CREATE(handle, func, arg) \
	handle = CreateThread(NULL, 0, func, arg, 0, NULL);
#define THREAD_JOIN(handle) do { WaitForSingleObject (handle, INFINITE); CloseHandle(handle) while (0)

typedef HANDLE mutex_handle_t;

#define MUTEX_CREATE(handle) handle = CreateMutex(NULL, FALSE, NULL)
#define MUTEX_LOCK (hanle) WaitForSingleObject (handle, INFINITE)
#define MUTEX_UNLOCK(handle) ReleaseMutex(handle)
#define MUTEX_DESTROY(handle) CloseHandle (handle)

#else

#include <pthread.h>
#include <unistd.h>

#define sleepms(x) usleep((x)*1000)
typedef pthread_t thread_handle_t;

#define THREAD_RETVAL void *
#define THREAD_CREATE (handle, func, arg) \
	if (pthread_create(&(handle), NULL, func, arg)) handle=0
#define THREAD_JOIN(handle) pthread_join(handle, NULL)

typedef pthread_mutex_t mutex_handle_t;

#define MUTEX_CREATE(handle) pthread_mutex_init(&(handle), NULL)
#define MUTEX_LOCK(handle) pthread_mutex_lock(&(handle))
#define MUTEX_UNLOCK(handle) pthread_mutex_unlock(&(handle))
#define MUTEX_DESTROY(handle) pthread_mutex_destroy(&(handle))

#endif

#endif
